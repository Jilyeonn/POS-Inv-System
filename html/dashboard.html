<html>
    <head>
        <title> POS & Inventory System</title>
        <link rel="stylesheet" type="text/css" href="../css/dashboard.css">
        <link rel="stylesheet" type="text/css" href="../css/invchart.css">
        <link rel="stylesheet" type="text/css" href="../css/navbar.css">
        <link rel="stylesheet" type="text/css" href="../css/saleschart.css">
        <link rel="icon" type="img/png" href="../img/logo.png" src="../img/logo.png">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <script type="module" src="../js/invchart.js"></script>
        <script type="module" src="../js/saleschart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
    </head>

    <body>
        <!--Start of Navigation Bar-->
   <header>
    <div class="logo">
      <img src="../img/logo.png">
      <h1>VHT Naturals</h1>
    </div>

    
    <nav>
      <ul id="nav-links">
       <li> <a href="#">Dashboard â–¾</a>
          <div class="dropdown">
            <a href="#" onclick="showPage('sales')">Sales</a>
            <a href="#" onclick="showPage('inventory')">Inventory</a>
            </div>
          </li>
        <li><a href="pos.html">Point of Sales</a></li>
        <li><a href="inventory.html">Inventory</a></li>
        <li><a href="receipthistory.html">Transaction History</a></li>
        <li><a href="/index.html">Logout</a></li>
      </ul>
    </nav>

    <button class="menu-toggle" id="menu-toggle">
      <i data-lucide="menu"></i>
    </button>

  </header>
        <!-- End of Navigation Bar -->
        <!-- Body of Dashboard (Charts and Graphs of Sales & Inventory)-->

        <div class="container-1">
  

        <!-- Sales Dashboard -->
        <div id="sales" class="page active">
        <section class="cards">
         <div class="card">
        <h3>Total Sales (Today)</h3>
        <div class="value" id="totalToday">â‚±0.00</div>
      </div>
      <div class="card">
        <h3>Total Sales (This Month)</h3>
        <div class="value" id="totalMonth">â‚±0.00</div>
      </div>
      <div class="card">
        <h3>Orders (Today)</h3>
        <div class="value" id="ordersToday">0</div>
      </div>
      <div class="card">
        <h3>Average Sales (Today) </h3>
        <div class="value" id="avgTicket">â‚±0.00</div>
      </div>
    </section>

    <!-- Charts -->
    <section class="charts-grid">
    <div class="chart-card">
    <div class="chart-header">
    <h4>Sales (by period)</h4>
    <select id="salesPeriodSelect">
      <option value="weekly">Weekly</option>
      <option value="monthly" selected>Monthly</option>
      <option value="quarterly">Quarterly</option>
    </select>
  </div>
        <canvas id="lineSales"></canvas>
      </div>


      <div class="chart-card" class="chart-card full-width">
      <h4> Top Products (by revenue)</h4>
        <canvas id="barProducts"></canvas>
      </div>
      
    <div class="chart-card">
        <h4>Sales by Category </h4>
        <canvas id="pieCategories"></canvas>
      </div>
      <!-- Transaction History Preview Table -->
  <div class="chart-card">
    <h4>Recent Transactions</h4>
    <table id="transactionHistory">
      <thead>
        <tr>
          <th>Order No. </th>
          <th>Date </th>
          <th>Item</th>
          <th>Total</th>
          <th>Cash </th>
        <th>Change</th>
        </tr>
      </thead>
      <tbody>
        <!-- Filled dynamically -->
      </tbody>
    </table>
  </div>
        </div>
    </section>
      

        <!-- Inventory Dashboard -->
  <div id="inventory" class="page">
    <section class="cards">
    <div class="card">
      <h3>Total Items</h3>
      <p id="totalItems">0</p>
    </div>

    <div class="card">
      <h3>Total Quantity</h3>
      <p id="totalQty">0</p>
    </div>

    <div class="card">
      <h3>Total Value</h3>
      <p id="totalValue">â‚±0</p>
    </div>

    <div class="card">
      <h3>Low Stock Items</h3>
      <p id="lowStock">0</p>
    </div>
    </section>


    <div class="charts-container">
        <div class="chart-card1">
            <h3>Supplies Quantity</h3>
            <canvas id="pieChart1"></canvas>
        </div>
        
        <div class="chart-card1">
            <h3>Inventory Category Distribution</h3>
            <canvas id="pieChart2"></canvas>
        </div>
        
        <div class="chart-card1">
            <h3>Added Supplies This Month</h3>
            <canvas id="lineChart"></canvas>
        </div>

    </div>
  </div>
    
        </div>
        
        <!--SCRIPT NA ITO -->

  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    lucide.createIcons();

    function showWarningPopup() {
  let popup = document.getElementById("inactivityWarning");
  if (!popup) {
    popup = document.createElement("div");
    popup.id = "inactivityWarning";
    popup.textContent = "âš ï¸ You have been inactive. Auto logout in 30 seconds...";
    Object.assign(popup.style, {
      position: "fixed",
      bottom: "20px",
      right: "20px",
      background: "rgba(0,0,0,0.ðŸ˜Ž",
      color: "white",
      padding: "10px 15px",
      borderRadius: "8px",
      zIndex: "9999",
      fontFamily: "sans-serif",
    });
    document.body.appendChild(popup);
  } else {
    popup.style.display = "block";
  }
}

function hideWarningPopup() {
  const popup = document.getElementById("inactivityWarning");
  if (popup) popup.style.display = "none";
}

function startInactivityTimers() {
  if (inactivityTimer) clearTimeout(inactivityTimer);
  if (warningTimer) clearTimeout(warningTimer);
  hideWarningPopup();

  warningTimer = setTimeout(showWarningPopup, AUTO_LOGOUT_MS - 30000);

  inactivityTimer = setTimeout(async () => {
    const user = auth.currentUser;
    if (!user) return;

    if (!sessionStorage.getItem(AUTO_LOGOUT_DONE_KEY)) {
      sessionStorage.setItem(AUTO_LOGOUT_DONE_KEY, "1");
      await writeUserLog("auto logged out");
    }

    try {
      await signOut(auth);
    } catch (err) {
      console.error("signOut error:", err);
    }
    sessionStorage.clear();
    window.location.href = "/index.html";
  }, AUTO_LOGOUT_MS);
}

function resetInactivityTimer() {
  if (auth.currentUser) startInactivityTimers();
}

["mousemove", "keydown", "click", "scroll", "touchstart"].forEach((evt) =>
  document.addEventListener(evt, resetInactivityTimer, { passive: true })
);
    const menuToggle = document.getElementById("menu-toggle");
    const navLinks = document.getElementById("nav-links");

    menuToggle.addEventListener("click", () => {
      navLinks.classList.toggle("active");
    });

    function showPage(pageId) {
      const pages = document.querySelectorAll('.page');
      pages.forEach(page => page.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      navLinks.classList.remove("active");
    }
    
  </script>
    </body>
</html>